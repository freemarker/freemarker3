<project name="freemarker" default="jar" basedir=".">

   <target name="init">

	<uptodate property="parser.uptodate"
                 targetfile="src/freemarker/core/parser/FMParser.java">
	 <srcfiles dir="src/parser" includes="*.javacc"/>
	</uptodate>
	
	<path id="class.path">
      <fileset dir="libs">
       <include name="*.jar" />
      </fileset>
    </path>
  </target>

  <target name="parser-gen" depends="init" unless="parser.uptodate">
 	<java jar="bootstrap/javacc.jar" fork="true">
 	   <arg value="src/parser/FM.javacc"/>
 	</java>
  </target>
  
  <target name="compile" depends="parser-gen">
  	<mkdir dir="build"/>
    <javac srcdir="src" 
 	       destdir="build"
 	       deprecation="off"
 	       debug="on"
 	       optimize="off"
           target="1.8"
           source="1.8"
    	   includeantruntime="true"
    	   nowarn="true"
    >
       <classpath refid="class.path"/>
    </javac>
  </target>
  
  <target name="jar" depends="compile">
     <jar jarfile="freemarker.jar" basedir="build" compress="true">
        <manifest>
           <attribute name="Main-Class" value="freemarker.core.CommandLine"/>
        </manifest>
     </jar>
  </target>
  
  
  <target name="clean">
     <delete file="src/freemarker/core/parser/FMParser.java"/>
     <delete file="src/freemarker/core/parser/FMLexer.java"/>
     <delete file="src/freemarker/core/parser/LexicalException.java"/>
     <delete file="src/freemarker/core/parser/SimpleCharStream.java"/>
     <delete file="src/freemarker/core/parser/Token.java"/>
     <delete file="src/freemarker/core/parser/FMConstants.java"/>
     <delete file="src/freemarker/core/parser/FMParser.html"/>
     <delete file="src/freemarker/core/parser/Node.java"/>
     <delete file="src/freemarker/core/parser/Nodes.java"/>
     <delete dir="build"/>
  </target>
  
</project>
